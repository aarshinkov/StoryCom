<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
  <body>

    <nav id="mainMenu" class="navbar navbar-expand-md navbar-dark bg-info">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03"
              aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" th:text="#{app.title}" th:href="@{/}" href="#">StoryCom</a>

      <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
        <ul class="navbar-nav mr-auto mt-0">
          <li class="nav-item" th:classappend="${globalMenu eq 'home'}  ? 'active'">
            <a class="nav-link" th:href="@{/}" th:text="#{nav.home.general}">Home</a>
          </li>

          <li class="nav-item dropdown" th:classappend="${globalMenu eq 'story'} ? 'active'">
            <a class="nav-link" href="#" id="storiesDropdown" role="button" data-toggle="dropdown"
               aria-haspopup="true" aria-expanded="false">
              <span th:text="#{nav.story}">Stories</span>
              <i class="fas fa-caret-down"></i>
            </a>
            <div class="dropdown-menu" aria-labelledby="storiesDropdown">
              <a class="dropdown-item" th:classappend="${subMenu eq 'add'} ? 'active'" href="#"
                 sec:authorize="hasRole('ROLE_USER')" th:href="@{/stories/add}"
                 th:text="#{nav.story.add}">Add story</a>
              <a class="dropdown-item" th:classappend="${subMenu eq 'search'} ? 'active'" href="#"
                 th:href="@{/stories/search}" th:text="#{nav.story.search}">Search
                story</a>
              <!--<div class="dropdown-divider"></div>-->
            </div>
          </li>

          <li class="nav-item" sec:authorize="hasRole('ROLE_ADMIN')"
              th:classappend="${globalMenu eq 'admin'} ? 'active'">
            <a class="nav-link" th:href="@{/admin}" th:text="#{nav.admin}">Admin</a>
          </li>
        </ul>

        <ul class="navbar-nav mt-lg-0">
          <!--          <li class="nav-item" sec:authorize="isAuthenticated()">
                      <a class="nav-link" th:href="@{/}" th:text="'Hello, ' + ${@usersBean.principal.fullName}" href="#">Hello, user</a>
                    </li>-->

          <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span th:text="'Hello, ' + ${@usersBean.principal.fullName}">Hello, User</span>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
              <a class="dropdown-item" href="#" th:href="@{/profile}" th:text="#{nav.profile}">Profile</a>
              <a class="dropdown-item" href="#" th:href="@{/settings}" th:text="#{nav.settings}">Settings</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" onclick="$('#formLogout').submit();" style="cursor: pointer;" th:text="#{nav.logout}">Logout</a>
            </div>
          </li>

          <li class="nav-item" sec:authorize="!isAuthenticated()"
              th:classappend="${globalMenu eq 'login'} ? 'active'">
            <a class="nav-link" th:href="@{/login}" th:text="#{nav.login}" href="#">Login</a>
          </li>

          <li class="nav-item" sec:authorize="!isAuthenticated()"
              th:classappend="${globalMenu eq 'signup'} ? 'active'">
            <a class="nav-link" th:href="@{/signup}" th:text="#{nav.signup}" href="#">Sign up</a>
          </li>

          <form style="visibility: hidden;" id="formLogout" method="post" action="#" th:action="@{/logout}"></form>

          <!--<li class="nav-item" sec:authorize="isAuthenticated()">-->
          <!--<a class="nav-link" th:href="@{/logout}" th:text="#{nav.logout}" href="#">Logout</a>-->
          <!--</li>-->
        </ul>
      </div>
    </nav>
  </body>
</html>